<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"sidebar":null,"position":"left         //靠左放置","display":"always       //在所有页面中都显示","offset":"12            //文章间距（只对Pisces | Gemini两种风格有效）","b2t":"false            //返回顶部按钮（只对Pisces | Gemini两种风格有效）","scrollpercent":"true   //返回顶部按钮的百分比"},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":false,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="面向对象编程和泛型编程都能处理编写程序时不知道类型的情况 区别就是OOP是在运行时处理，而泛型编程是在编译的时候就能知道类型了">
<meta property="og:type" content="article">
<meta property="og:title" content="模板与泛型编程">
<meta property="og:url" content="http://example.com/2020/11/18/%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="笔记杂货铺">
<meta property="og:description" content="面向对象编程和泛型编程都能处理编写程序时不知道类型的情况 区别就是OOP是在运行时处理，而泛型编程是在编译的时候就能知道类型了">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zhuom-go.github.io/img/Template/1.png">
<meta property="og:image" content="https://zhuom-go.github.io/img/Template/2.png">
<meta property="og:image" content="https://zhuom-go.github.io/img/Template/3.png">
<meta property="og:image" content="https://zhuom-go.github.io/img/Template/4.png">
<meta property="og:image" content="https://zhuom-go.github.io/img/Template/5.png">
<meta property="article:published_time" content="2020-11-18T14:32:25.058Z">
<meta property="article:modified_time" content="2020-11-23T08:17:35.578Z">
<meta property="article:author" content="zhuoM">
<meta property="article:tag" content="STL">
<meta property="article:tag" content="Template">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhuom-go.github.io/img/Template/1.png">

<link rel="canonical" href="http://example.com/2020/11/18/%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<link rel="stylesheet" type="text/css" href="/css/injector.css" />
  <title>模板与泛型编程 | 笔记杂货铺</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">笔记杂货铺</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一条想翻身的咸鱼</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-学习规划">

    <a href="https://mind.airmore.cn/doc/ee1a0a03d527fce6988ca8544c4ff330%20/" rel="noopener" target="_blank"><i class="fa fa-user fa-fw"></i>学习规划</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/zhuoM-Go" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/18/%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/Logo.png">
      <meta itemprop="name" content="zhuoM">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="笔记杂货铺">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          模板与泛型编程
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-18 22:32:25" itemprop="dateCreated datePublished" datetime="2020-11-18T22:32:25+08:00">2020-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-23 16:17:35" itemprop="dateModified" datetime="2020-11-23T16:17:35+08:00">2020-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/STL/" itemprop="url" rel="index"><span itemprop="name">STL</span></a>
                </span>
            </span>

          
            <span id="/2020/11/18/%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/" class="post-meta-item leancloud_visitors" data-flag-title="模板与泛型编程" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/11/18/%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/11/18/%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>25k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>22 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>面向对象编程和泛型编程都能处理编写程序时不知道类型的情况</p>
<p>区别就是OOP是在运行时处理，而泛型编程是在编译的时候就能知道类型了<a id="more"></a></p>
<h3 id="1、函数模板"><a href="#1、函数模板" class="headerlink" title="1、函数模板"></a>1、函数模板</h3><h4 id="1-1、定义模板"><a href="#1-1、定义模板" class="headerlink" title="1.1、定义模板"></a>1.1、定义模板</h4><p>我们可以为函数定义一个模板，而不是为每一个类型定义一个函数。</p>
<p>比较函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">const</span> T&amp;v1, <span class="keyword">const</span> T&amp;v2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(v1 &lt; v2) </span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(v1 &gt; v2)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i1 = <span class="number">10</span>, i2 = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">double</span> d1 = <span class="number">20.1</span>, d2 = <span class="number">20.01</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> u1 = <span class="number">10</span>, u2 = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; compare(i1, i2) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; compare(d1, d2) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; compare(u1, u2) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>模板定义以关键字<strong>template</strong>开始，</p>
<p>后面跟一个参数列表，这是一个逗号分隔的一个或多个模板参数的列表，用<code>&lt; &gt;</code>包围起来。</p>
<p>当我们调用一个函数模板时，编译器会用函数的实参来为我们推断模板实参</p>
<h4 id="1-2、类型参数"><a href="#1-2、类型参数" class="headerlink" title="1.2、类型参数"></a>1.2、类型参数</h4><p>类型参数前必须使用关键字<code>class</code>或者<code>typename</code></p>
<p>在模板参数列表中，这两个关键字的含义相同，可以互换使用，一个模板参数列表中可以同时使用这两个关键字</p>
<p>类型参数在函数中使用我们就把它当作正常类型使用就可以了，比如作为函数的参数，返回值，以及函数内部定义变量等等</p>
<h4 id="1-3、非类型模板参数"><a href="#1-3、非类型模板参数" class="headerlink" title="1.3、非类型模板参数"></a>1.3、非类型模板参数</h4><p>除了定义类型参数，我们还可以定义非类型参数，非类型参数表示一个值而非一个类型，我们通过一个特定的类型名而非关键字class或typename来指定。</p>
<p>当一个模板被实例化，非类型参数被一个编译器推断的值所取代。</p>
<p>一个非类型参数可以是一个整形，或者是一个指向对象或函数类型的指针或（左值）引用，绑定到非类型整形参数必须是一个常量，绑定到指针或引用的非类型模板</p>
<p>参数的实参必须有静态生存期。</p>
<p>注意：非类型模板参数的模板必须是常量表达式</p>
<p><code>inline </code>和<code>constexpr</code>也可以修饰函数模板，放在返回值前面</p>
<h4 id="1-4、编写类型无关的代码"><a href="#1-4、编写类型无关的代码" class="headerlink" title="1.4、编写类型无关的代码"></a>1.4、编写类型无关的代码</h4><p>编写泛型代码的两个重要的原则</p>
<p>&lt;1.模板中的函数参数是const的引用</p>
<p>&lt;2.函数体条件中判断仅仅使用&lt;比较</p>
<p>这两个可以降低对类型的要求</p>
<p>比如const的引用，就保证了函数可以用于不能拷贝的类型。</p>
<p><code>&lt;</code>比较就可以用于大多数定义了<code>&lt;</code>比较的类型。</p>
<p><strong>结论：模板程序应该尽量减少对实参类型的要求</strong></p>
<h4 id="1-5、模板编译"><a href="#1-5、模板编译" class="headerlink" title="1.5、模板编译"></a>1.5、模板编译</h4><p>模板编译和普通的编译不同，它是在使用实例化时编译器才生成代码，为了生成一个实例化版本，编译器需要掌握函数模板或类模板成员函数的定义，</p>
<p>因此和非模板代码不同，模板的头文件通常既包括声明又包括定义。</p>
<p>模板的设计者应该提供一个头文件，包含模板定义以及在类模板或成员定义中用到的所有名字的声明。</p>
<p>模板的用户必须包含模板的头文件，以及用来实例化模板的任何类型的头文件。</p>
<h4 id="1-6、大多数编译错误在实例化期间报告"><a href="#1-6、大多数编译错误在实例化期间报告" class="headerlink" title="1.6、大多数编译错误在实例化期间报告"></a>1.6、大多数编译错误在实例化期间报告</h4><p>保证传递给模板的实参支持模板所要求的操作，以及这些操作在模板中能正确工作，是调用者的责任。</p>
<p>例题：编写行为类似find算法的模板，函数需要两个模板类型参数，一个表示函数的迭代器参数，另外一个表示值的类型。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> iterator, <span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">iterator <span class="title">Find</span><span class="params">(<span class="keyword">const</span> iterator &amp;beg, <span class="keyword">const</span> iterator &amp;end, <span class="keyword">const</span> T&amp;ele)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it = beg; it != end; ++it)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(*it == ele)</span><br><span class="line">            <span class="keyword">return</span> it;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> end;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;ivec1 = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">auto</span> ret = Find(begin(ivec1), end(ivec1), <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">if</span>(ret == end(ivec1))</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;not find&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;find &quot;</span> &lt;&lt; *ret &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">list</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;il = &#123;<span class="string">&quot;111&quot;</span>,<span class="string">&quot;222&quot;</span>,<span class="string">&quot;333&quot;</span>,<span class="string">&quot;444&quot;</span>,<span class="string">&quot;555&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">auto</span> ret2 = Find(il.begin(), il.end(), <span class="string">&quot;333&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(ret2 == il.end())</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;not find&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;find &quot;</span> &lt;&lt; *ret2 &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><img src="https://zhuom-go.github.io/img/Template/1.png" alt="img"></p>
<h3 id="2、类模板"><a href="#2、类模板" class="headerlink" title="2、类模板"></a>2、类模板</h3><p>类模板是生成类的模板-。</p>
<p>它和函数模板的不同是它不能向函数模板一样推断出类型是什么，而是要自己指定类型是什么</p>
<p>比如<code>vector&lt;T&gt;</code>就是一个模板类，T可以是任何类型<code>int ,double ,string</code>或者是自己定义的类类型</p>
<p>举个书上的例子来说一些概念和注意的</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _BLOB_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _BLOB_H_</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;initializer_list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdexcept&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;strblob.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//必须声明</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">blobptr</span>;</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">blob</span>;</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> blob&lt;T&gt;&amp;, <span class="keyword">const</span> blob&lt;T&gt;&amp;);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">blob</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        <span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">blobptr</span>&lt;</span>T&gt;;</span><br><span class="line">        <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>==&lt;T&gt;(<span class="keyword">const</span> blob&lt;T&gt;&amp;, <span class="keyword">const</span> blob&lt;T&amp;&gt;);</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">typedef</span> T value_type;</span><br><span class="line">        <span class="comment">//加上typename 是因为T是一个模板类型，编译器不知道std::vector&lt;T&gt;::size_type 是什么,加上typename就是告诉编译器是一个type</span></span><br><span class="line">        <span class="keyword">typedef</span> <span class="keyword">typename</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt;::size_type size_type;</span><br><span class="line">        blob();</span><br><span class="line">        blob(<span class="built_in">std</span>::<span class="built_in">initializer_list</span>&lt;T&gt; il);</span><br><span class="line"> </span><br><span class="line">        <span class="function">size_type <span class="title">size</span><span class="params">()</span><span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> data-&gt;size(); &#125;</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span><span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> data-&gt;empty(); &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">push_back</span><span class="params">(<span class="keyword">const</span> T&amp;t)</span> </span>&#123; <span class="keyword">return</span> data-&gt;push_back(t); &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">push_back</span><span class="params">(T &amp;&amp;t)</span> </span>&#123; <span class="keyword">return</span> data-&gt;push_back(<span class="built_in">std</span>::move(t)); &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">pop_back</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="function">T&amp; <span class="title">back</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="function">T&amp; <span class="title">front</span><span class="params">()</span></span>;</span><br><span class="line">        T&amp; <span class="keyword">operator</span>[] (size_type i);</span><br><span class="line">        <span class="keyword">const</span> T&amp; <span class="keyword">operator</span>[](size_type i)<span class="keyword">const</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">check</span><span class="params">(size_type i, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;s)</span><span class="keyword">const</span></span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt;&gt; data;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;blob.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//类模板的成员函数必须具有和模板相同的模板参数</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">blob&lt;T&gt;::blob():data(<span class="built_in">std</span>::make_shared&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt;&gt;()) &#123; &#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">blob&lt;T&gt;::blob(<span class="built_in">std</span>::<span class="built_in">initializer_list</span>&lt;T&gt; il):</span><br><span class="line">    data(<span class="built_in">std</span>::make_shared&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt;&gt;(il)) &#123; &#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">void</span> blob&lt;T&gt;::check(size_type i, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;s)<span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(i &gt;= data-&gt;size())</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">std</span>::out_of_range(s);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">void</span> blob&lt;T&gt;::pop_back()</span><br><span class="line">&#123;</span><br><span class="line">    check(<span class="number">0</span>, <span class="string">&quot;pop_back on empty blob&quot;</span>);</span><br><span class="line">    data-&gt;pop_back();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">T&amp; blob&lt;T&gt;::front()</span><br><span class="line">&#123;</span><br><span class="line">    check(<span class="number">0</span>, <span class="string">&quot;back on empty blob&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> data-&gt;front();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">T&amp; blob&lt;T&gt;::back()</span><br><span class="line">&#123;</span><br><span class="line">    check(<span class="number">0</span>, <span class="string">&quot;back on empty blob&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> data-&gt;back();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">T&amp; blob&lt;T&gt;::<span class="keyword">operator</span>[](blob&lt;T&gt;::size_type i)</span><br><span class="line">&#123;</span><br><span class="line">    check(i, <span class="string">&quot;subscript out of range&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;T&gt;(<span class="keyword">const_cast</span>&lt;<span class="keyword">const</span> blob&lt;T&gt;&gt;(*<span class="keyword">this</span>)[i]);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">const</span> T&amp; blob&lt;T&gt;::<span class="keyword">operator</span>[](blob&lt;T&gt;::size_type i)<span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    check(i, <span class="string">&quot;subscript out of range&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> (*data)[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _STRBLOB_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _STRBLOB_H_</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdexcept&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;blob.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//必须要其他的.h文件声明，否则无法使用</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">blob</span>;</span>   </span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">blobptr</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        blobptr():curr(<span class="number">0</span>)&#123; &#125;</span><br><span class="line">        blobptr(blob&lt;T&gt; &amp;a, <span class="built_in">std</span>::<span class="keyword">size_t</span> sz = <span class="number">0</span>):</span><br><span class="line">            wptr(a.data), curr(sz) &#123; &#125;</span><br><span class="line">        T&amp; <span class="keyword">operator</span>*()<span class="keyword">const</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">auto</span> p = check(curr, <span class="string">&quot;* error&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> (*p)[curr];</span><br><span class="line">        &#125;</span><br><span class="line">        blobptr&amp; <span class="keyword">operator</span>++();</span><br><span class="line">        blobptr&amp; <span class="keyword">operator</span>--();</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt;&gt;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">check</span><span class="params">(<span class="built_in">std</span>::<span class="keyword">size_t</span> i, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;msg)</span></span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="keyword">size_t</span> curr;</span><br><span class="line">        <span class="built_in">std</span>::weak_ptr&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt;&gt;wptr;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;strblob.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt;&gt;</span><br><span class="line">blobptr&lt;T&gt;::check(<span class="built_in">std</span>::<span class="keyword">size_t</span> i, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;msg)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//检查是否存在</span></span><br><span class="line">    <span class="keyword">auto</span> ret = wptr.lock();</span><br><span class="line">    <span class="keyword">if</span>(!ret)</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">std</span>::runtime_error(<span class="string">&quot;unbound blobptr&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(i &lt; <span class="number">0</span> &amp;&amp; i &gt;= ret-&gt;size())</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">std</span>::out_of_range(msg);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">blobptr&lt;T&gt;&amp; blobptr&lt;T&gt;::<span class="keyword">operator</span>++()</span><br><span class="line">&#123;</span><br><span class="line">    blobptr ret = *<span class="keyword">this</span>;</span><br><span class="line">    ++*<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">blobptr&lt;T&gt;&amp; blobptr&lt;T&gt;::<span class="keyword">operator</span>--()</span><br><span class="line">&#123;</span><br><span class="line">    blobptr ret = *<span class="keyword">this</span>;</span><br><span class="line">    --*<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 1.一个类模板的每个实例都形成一个独立的类，但是类和类之间没有关系。 </p>
<p>2.我们既可以在类模板外部为其定义成员函数，也可以在类模板内部定义，内部定义被隐式的声明为内敛函数。</p>
<p>3.类模板的成员函数具有和模板相同的模板参数，因此，定义在模板之外的成员函数就必须以关键字template开始，后接参数列表.</p>
<p>4.默认情况下，对于一个实例化的类模板，其成员只有在使用时才被实例化。</p>
<p>5.当我们使用一个类模板类型必须提供模板参数，但有一个例外，在类模板自己的作用域中，我们可以直接使用模板名而不提供实参。</p>
<blockquote>
<p><strong>模板类和友元</strong></p>
</blockquote>
<p>6.类和友元各自是否是模板是无关的。友元关系被限定在用相同的类型实例化。</p>
<p>7.一个模板类也可以指定另外一个模板类为友元或者另外一个模板类的特定实例</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"> </span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">//friend class C&lt;int&gt;;                 //特定类为友元</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> X&gt; <span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">C</span>;</span>  <span class="comment">//模板类为友元</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">C</span>;</span>  <span class="comment">//error:本模板类参数列表已经包含T了，友元不可再次包含T,需要换参数,否则会报错显示应藏参数</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>8.令自己的 实例化类型作为友元(c++11) </p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> X&gt; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">friend</span> T;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>那么我们实例化的时候，实例化类型是A，A就是模板类的友元，A可以是类类型，或者是内置类型。 </p>
<blockquote>
<p>9.类模板别名(c++11)</p>
</blockquote>
<p>旧标准中，我们只能使用typedef 为特定模板类型定义类型别名。</p>
<p>c++11标准中，我们可以为模板类定义模板类型别名，而且多个参数时可以指定参数是T或者是特定类型。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> X, <span class="keyword">typename</span> Z&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"> </span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//template参数列表指定参数的个数，但是我们能指定一个或多个特定类型比如TEP2的int</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> X, <span class="keyword">typename</span> Z&gt; <span class="keyword">using</span> TEP = C&lt;T, X, Z&gt;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> X&gt; <span class="keyword">using</span> TEP2 = C&lt;T, X, <span class="keyword">int</span>&gt;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    C&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; c;</span><br><span class="line">    TEP&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; t;</span><br><span class="line">    TEP2&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; t2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>10.类模板的static成员</p>
</blockquote>
<p>当类模板包含<code>static</code>成员时（数据或者是函数）,每个类模板的实例都有一个static成员，而且定义类模板的static成员时，前面必须加<code>template &lt;参数列表&gt;</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fun</span><span class="params">(T &amp;a)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> i;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">void</span> C&lt;T&gt;::fun(T &amp;a)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//别忘记了int</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">int</span> C&lt;T&gt;::i = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    C&lt;<span class="keyword">int</span>&gt;c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>11.使用模板时别偷懒，时刻注意模板声明template和参数列表，使用时记得注意指定类型，不明则使用T</p>
<h3 id="3、模板参数"><a href="#3、模板参数" class="headerlink" title="3、模板参数"></a>3、模板参数</h3><h4 id="3-1、模板参数和作用域"><a href="#3-1、模板参数和作用域" class="headerlink" title="3.1、模板参数和作用域"></a>3.1、模板参数和作用域</h4><p>模板参数符合隐藏规则，而且一个模板参数名在参数列表中只能出现一次。</p>
<p>一个特定文件所需要的所有模板的声明通常一起放置在文件开始位置，出现于任何使用这些模板的代码之前。</p>
<h4 id="3-2、使用类的类型成员"><a href="#3-2、使用类的类型成员" class="headerlink" title="3.2、使用类的类型成员"></a>3.2、使用类的类型成员</h4><p>我们处理模板的时候，必须让编译器知道名字是否表示一个类型</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T::size_type *p;    <span class="comment">//error   typename T::size_type *p</span></span><br></pre></td></tr></table></figure>

<p>我们不知道T是一个名字还是模板的参数列表里的类型，c++编译器默认为名字。 </p>
<p>所以如果我们像上面想表示为一个类型的话必须显式的指定，在前面添加关键字typename</p>
<h4 id="3-3、默认模板实参"><a href="#3-3、默认模板实参" class="headerlink" title="3.3、默认模板实参"></a>3.3、默认模板实参</h4><p>在新标准中，我们可以为函数和类模板提供默认实参</p>
<p>函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//X默认实参是std::less&lt;T&gt;这个函数对象</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> X = <span class="built_in">std</span>::less&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">int</span> compare(<span class="keyword">const</span> T &amp;v1, <span class="keyword">const</span> T &amp;v2, X x = X())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(x(v1, v2))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; v1 &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; v2 &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x(v2, v1))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; v1 &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; v2 &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//传参数函数对象std::greater</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; compare(<span class="number">0</span>, <span class="number">1</span>, <span class="built_in">std</span>::greater&lt;<span class="keyword">int</span>&gt;()) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">//使用默认参数  std::less</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; compare(<span class="number">0</span>, <span class="number">1</span>) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://zhuom-go.github.io/img/Template/2.png" alt="img"></p>
<p>类：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T = <span class="keyword">int</span>&gt; </span><br><span class="line">class C</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        C(T v = <span class="number">0</span>):</span><br><span class="line">            val(v) &#123; &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        T val;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    C&lt;&gt; c;            <span class="comment">//使用默认int</span></span><br><span class="line">    C&lt;<span class="keyword">double</span>&gt; c2;     <span class="comment">//覆盖默认int改用double</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<p>记住<code>typename</code>和<code>class</code>不是完全相同的，在指明是一个类型而不是名字的情况下必须用<code>typename</code></p>
<p>比如<code>typedef typename T::size_type = size_type </code></p>
<h4 id="3-4、成员模板"><a href="#3-4、成员模板" class="headerlink" title="3.4、成员模板"></a>3.4、成员模板</h4><h5 id="3-4-1、普通（非模板）类的成员模板"><a href="#3-4-1、普通（非模板）类的成员模板" class="headerlink" title="3.4.1、普通（非模板）类的成员模板"></a>3.4.1、普通（非模板）类的成员模板</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DebugDelete</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        DebugDelete(<span class="built_in">std</span>::ostream &amp;s = <span class="built_in">std</span>::<span class="built_in">cerr</span>):</span><br><span class="line">            os(s) &#123; &#125;</span><br><span class="line">        <span class="comment">//类成员模板</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(T *p)</span><span class="keyword">const</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            os &lt;&lt; <span class="string">&quot;deleting unique_ptr&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">delete</span> p;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="built_in">std</span>::ostream &amp;os;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> *p = <span class="keyword">new</span> <span class="keyword">double</span>;</span><br><span class="line">    DebugDelete d;</span><br><span class="line">    d(p);</span><br><span class="line">    <span class="keyword">int</span> *i = <span class="keyword">new</span> <span class="keyword">int</span>;</span><br><span class="line">    DebugDelete()(i);    <span class="comment">//调用默认构造函数，生成一个DebugDelete类型的对象，括号必须加上，再根据构造函数是否有形参添加相应的参数。</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span> , DebugDelete&gt;p2(<span class="keyword">new</span> <span class="keyword">int</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-4-2、类模板的成员模板"><a href="#3-4-2、类模板的成员模板" class="headerlink" title="3.4.2、类模板的成员模板"></a>3.4.2、类模板的成员模板</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> X&gt;C(X b, X e);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt;ivec;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;       <span class="comment">//类的参数列表</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> X&gt;       <span class="comment">//构造函数的参数列表</span></span><br><span class="line">C&lt;T&gt;::C(X b, X e)</span><br><span class="line">&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;svc = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">    C&lt;<span class="keyword">int</span>&gt;c(svc.begin(), svc.end());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-4-3、实例化与成员模板"><a href="#3-4-3、实例化与成员模板" class="headerlink" title="3.4.3、实例化与成员模板"></a>3.4.3、实例化与成员模板</h5><p>实例化一个类模板的成员函数模板，类模板必须明确指出类型，函数模板根据参数推断出类型，如上面main函数里面的实例。</p>
<h4 id="3-5、控制实例化"><a href="#3-5、控制实例化" class="headerlink" title="3.5、控制实例化"></a>3.5、控制实例化</h4><p>我们知道一个模板在使用时根据不同的类型就会产生不同实例化。</p>
<p>如果在多个文件中使用模板，产生的多个实例化可能会重复，带来额外的开销影响效率。</p>
<p>我们可以通过显式实例化来解决问题</p>
<p>形式：</p>
<p><code>extern template declaration</code>  //实例化声明</p>
<p><code>template declaration</code>        //实例化定义</p>
<p>我们只需要在一个文件中实例化定义，其他文件实例化声明即可。</p>
<p><strong>注意：对每个实例化声明，在程序中某个位置必须有其显式的实例化定义</strong></p>
<p><strong>实例化定义会实例化所有成员，包括内敛函数成员</strong></p>
<p><strong>所以在一个类模板定义中，所用类型必须能用于模板的所有成员函数</strong></p>
<h4 id="3-6、效率与灵活性"><a href="#3-6、效率与灵活性" class="headerlink" title="3.6、效率与灵活性"></a>3.6、效率与灵活性</h4><p>书上举的是<code>shared_ptr </code>和<code>unique_ptr </code>的例子</p>
<p>这两个智能指针都能绑定删除器</p>
<p><code>shared_ptr</code>删除器：在运行时绑定的删除器</p>
<p>在一个<code>shared_ptr</code>的生存期中，我们可以随时改变其删除器的类型。</p>
<p><code>unique_ptr</code>删除器：在编译时绑定的删除器</p>
<p><code>unique_ptr</code>的删除器是<code>unique_ptr</code>的一部分</p>
<p><code>unique_ptr</code>有两个模板参数，一个表示它所管理的指针，另一个表示删除器的类型，在编译时绑定，所以没有运行开销</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">shared_ptr</span></span></span><br><span class="line"><span class="class"><span class="title">template</span> &lt;</span><span class="keyword">typename</span> T, <span class="class"><span class="keyword">class</span> <span class="title">D</span> =</span> dedault_delete&lt;T&gt;&gt; <span class="class"><span class="keyword">class</span> <span class="title">unique_ptr</span></span></span><br></pre></td></tr></table></figure>

<p>通过编译时绑定删除器，<code>unique_ptr </code>避免了间接调用删除器的运行时开销。 </p>
<p>通过运行时绑定删除器，<code>shared_ptr </code>使用户重载删除器更加方便。</p>
<p>自己实现<code>shared_ptr </code>和 <code>unique_ptr</code></p>
<p>参考别人的实现  <a target="_blank" rel="noopener" href="https://github.com/Mooophy/Cpp-Primer/tree/master/ch16/ex16.28">https://github.com/Mooophy/Cpp-Primer/tree/master/ch16/ex16.28</a></p>
<p><code>shared_ptr</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//声明</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>&gt; <span class="class"><span class="keyword">class</span> <span class="title">Myshared_ptr</span>;</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(Myshared_ptr&lt;T&gt;&amp;lhs, Myshared_ptr&lt;T&gt;&amp;rhs)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//删除器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DebugDelete</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        DebugDelete(<span class="built_in">std</span>::ostream&amp;s = <span class="built_in">std</span>::<span class="built_in">cerr</span>):</span><br><span class="line">            os(s) &#123; &#125;</span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(T *p)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            os &lt;&lt; <span class="string">&quot;delete~&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">delete</span> p;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="built_in">std</span>::ostream &amp;os;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myshared_ptr</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">//自定义交换函数</span></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(Myshared_ptr&lt;T&gt;&amp;lhs, Myshared_ptr&lt;T&gt;&amp;rhs)</span></span>;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        Myshared_ptr():</span><br><span class="line">            p(<span class="literal">nullptr</span>), num(<span class="keyword">new</span> <span class="built_in">std</span>::<span class="keyword">size_t</span>(<span class="number">0</span>)) &#123; &#125;</span><br><span class="line">        <span class="comment">//explicit避免隐式转换</span></span><br><span class="line">        <span class="function"><span class="keyword">explicit</span> <span class="title">Myshared_ptr</span><span class="params">(T *t, <span class="built_in">std</span>::function&lt;<span class="keyword">void</span>(T*)&gt;d = DebugDelete())</span>:</span></span><br><span class="line">            p(t), num(new std::size_t(1)), deleter(d) &#123; &#125;</span><br><span class="line">        Myshared_ptr(<span class="keyword">const</span> Myshared_ptr&amp; mp):</span><br><span class="line">            p(mp.p), num(mp.num), deleter(mp.deleter)</span><br><span class="line">            &#123; ++*num; &#125;</span><br><span class="line">        Myshared_ptr(Myshared_ptr &amp;&amp;mp)<span class="keyword">noexcept</span>;</span><br><span class="line">        Myshared_ptr&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Myshared_ptr &amp;);</span><br><span class="line">        Myshared_ptr&amp; <span class="keyword">operator</span>=(Myshared_ptr &amp;&amp;)<span class="keyword">noexcept</span>;</span><br><span class="line">        <span class="function"><span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span><span class="keyword">const</span></span></span><br><span class="line"><span class="function">        </span>&#123; <span class="keyword">return</span> p ? <span class="literal">true</span> : <span class="literal">false</span>; &#125;</span><br><span class="line">        </span><br><span class="line">        T&amp; <span class="keyword">operator</span>*()</span><br><span class="line">        &#123; <span class="keyword">return</span> *p; &#125;</span><br><span class="line">        </span><br><span class="line">        T* <span class="keyword">operator</span>-&gt;()</span><br><span class="line">        &#123; <span class="keyword">return</span> &amp; <span class="keyword">this</span>-&gt;<span class="keyword">operator</span>*(); &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="built_in">std</span>::<span class="keyword">size_t</span> <span class="title">use_count</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123; <span class="keyword">return</span> *num; &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function">T* <span class="title">get</span><span class="params">()</span><span class="keyword">const</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        </span>&#123; <span class="keyword">return</span> p; &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">unique</span><span class="params">()</span><span class="keyword">const</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        </span>&#123; <span class="keyword">return</span> *num == <span class="number">1</span>; &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(Myshared_ptr &amp;mp)</span></span></span><br><span class="line"><span class="function">        </span>&#123; ::swap(*<span class="keyword">this</span>, mp); &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span><span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            decrement_n_destroy();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(T *t)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(p == t)</span><br><span class="line">            &#123;</span><br><span class="line">                decrement_n_destroy();</span><br><span class="line">                p = t;</span><br><span class="line">                num = <span class="keyword">new</span> <span class="built_in">std</span>::<span class="keyword">size_t</span>(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        ~Myshared_ptr()</span><br><span class="line">        &#123;</span><br><span class="line">            decrement_n_destroy();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">decrement_n_destroy</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        T *p = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="keyword">size_t</span> *num = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="comment">//删除器,使用function是为了函数，函数指针，函数对象和lambda都可以作为删除器类型。</span></span><br><span class="line">        <span class="built_in">std</span>::function&lt;<span class="keyword">void</span>(T*)&gt;deleter&#123;DebugDelete()&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">swap(Myshared_ptr&lt;T&gt;&amp;lhs, Myshared_ptr&lt;T&gt;&amp;rhs)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="built_in">std</span>::swap;</span><br><span class="line">    swap(lhs.p, rhs.p);</span><br><span class="line">    swap(lhs.num, rhs.num);</span><br><span class="line">    swap(lhs.deleter, rhs.deleter);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">inline</span> Myshared_ptr&lt;T&gt;::Myshared_ptr(Myshared_ptr&lt;T&gt; &amp;&amp;mp)<span class="keyword">noexcept</span>:</span><br><span class="line">    p(mp.p), num(mp.num), deleter(<span class="built_in">std</span>::move(mp.deleter)) </span><br><span class="line">&#123;</span><br><span class="line">    mp.p = <span class="literal">nullptr</span>;</span><br><span class="line">    mp.num = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">inline</span> Myshared_ptr&lt;T&gt;&amp; </span><br><span class="line">Myshared_ptr&lt;T&gt;::<span class="keyword">operator</span>=(<span class="keyword">const</span> Myshared_ptr&lt;T&gt; &amp;mp)</span><br><span class="line">&#123;</span><br><span class="line">    ++*mp.num;</span><br><span class="line">    decrement_n_destroy();</span><br><span class="line">    p = mp.p;</span><br><span class="line">    num = mp.num;</span><br><span class="line">    deleter = mp.deleter;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">inline</span> Myshared_ptr&lt;T&gt;&amp;</span><br><span class="line">Myshared_ptr&lt;T&gt;::<span class="keyword">operator</span>=(Myshared_ptr&lt;T&gt; &amp;&amp;mp)<span class="keyword">noexcept</span></span><br><span class="line">&#123;</span><br><span class="line">    decrement_n_destroy();</span><br><span class="line">    ::swap(*<span class="keyword">this</span>, mp);</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="built_in">std</span>::ostream&amp;</span><br><span class="line"><span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream &amp;os, Myshared_ptr&lt;T&gt;&amp;p)</span><br><span class="line">&#123;</span><br><span class="line">    os &lt;&lt; p.get();</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">Myshared_ptr&lt;T&gt;::decrement_n_destroy()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(--*num == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">delete</span> num;</span><br><span class="line">            deleter(p);</span><br><span class="line">        &#125;</span><br><span class="line">        num = <span class="literal">nullptr</span>;</span><br><span class="line">        p = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Myshared_ptr&lt;<span class="keyword">int</span>&gt;p1;</span><br><span class="line">    Myshared_ptr&lt;<span class="keyword">int</span>&gt;p2(<span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">10</span>));</span><br><span class="line">    p1 = p2;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; p1.use_count() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>unique_ptr</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>&gt; <span class="class"><span class="keyword">class</span> <span class="title">Myunique_ptr</span>;</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> D&gt; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(Myunique_ptr&lt;T,D&gt; &amp;lhs, Myunique_ptr&lt;T,D&gt; &amp;rhs)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">default_delete</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        default_delete(<span class="built_in">std</span>::ostream &amp;s = <span class="built_in">std</span>::<span class="built_in">cerr</span>):</span><br><span class="line">            os(s) &#123; &#125;</span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(T *p)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            os &lt;&lt; <span class="string">&quot;delete ptr&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">delete</span> p;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="built_in">std</span>::ostream &amp;os;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> D = default_delete&gt;</span><br><span class="line">class Myunique_ptr</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">void</span> swap(Myunique_ptr&lt;T,D&gt;&amp;lhs, Myunique_ptr&lt;T,D&gt;&amp;rhs);</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">// preventing copy and assignment</span></span><br><span class="line">        Myunique_ptr(<span class="keyword">const</span> Myunique_ptr&lt;T&gt; &amp;) = <span class="keyword">delete</span>;</span><br><span class="line">        Myunique_ptr&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Myunique_ptr&lt;T&gt; &amp;) = <span class="keyword">delete</span>;</span><br><span class="line">        </span><br><span class="line">        Myunique_ptr() = <span class="keyword">default</span>;</span><br><span class="line">        <span class="comment">// explicit 禁止隐式转换</span></span><br><span class="line">        <span class="function"><span class="keyword">explicit</span> <span class="title">Myunique_ptr</span><span class="params">(T *t)</span>:</span></span><br><span class="line"><span class="function">            <span class="title">p</span><span class="params">(t)</span> </span>&#123; &#125;</span><br><span class="line">        <span class="comment">// 左值版本</span></span><br><span class="line">        Myunique_ptr(Myunique_ptr&lt;T&gt; &amp;&amp;mp)<span class="keyword">noexcept</span></span><br><span class="line">            :p(mp.p) &#123; mp.p = <span class="literal">nullptr</span>; &#125;</span><br><span class="line">        <span class="comment">// 在对象即将要销毁时可以复制</span></span><br><span class="line">        Myunique_ptr&amp; <span class="keyword">operator</span>=(Myunique_ptr &amp;&amp;mp)<span class="keyword">noexcept</span>;</span><br><span class="line">        Myunique_ptr&amp; <span class="keyword">operator</span>=(<span class="built_in">std</span>::<span class="keyword">nullptr_t</span> n)<span class="keyword">noexcept</span>;</span><br><span class="line"> </span><br><span class="line">        T&amp; <span class="keyword">operator</span>*()<span class="keyword">const</span></span><br><span class="line">        &#123; <span class="keyword">return</span> *p; &#125;</span><br><span class="line">        T* <span class="keyword">operator</span>-&gt;()<span class="keyword">const</span></span><br><span class="line">        &#123; <span class="keyword">return</span> &amp; <span class="keyword">this</span>-&gt;<span class="keyword">operator</span>*(); &#125;</span><br><span class="line">        <span class="function"><span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p ? <span class="literal">true</span> : <span class="literal">false</span>; &#125;</span><br><span class="line">        <span class="function">T* <span class="title">get</span><span class="params">()</span><span class="keyword">const</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        </span>&#123; <span class="keyword">return</span> p; &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(Myunique_ptr&lt;T,D&gt; &amp;rhs)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            ::swap(*<span class="keyword">this</span>, rhs);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span> <span class="keyword">noexcept</span>     </span>&#123; deleter(p); p = <span class="literal">nullptr</span>; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(T *t)</span><span class="keyword">noexcept</span>  </span>&#123; deleter(p); p = t; &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function">T* <span class="title">release</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">        ~Myunique_ptr()</span><br><span class="line">        &#123; deleter(p); &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        T *p;</span><br><span class="line">        D deleter = D();</span><br><span class="line"> </span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> D&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">swap(Myunique_ptr&lt;T,D&gt;&amp;lhs, Myunique_ptr&lt;T,D&gt;&amp;rhs)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="built_in">std</span>::swap;</span><br><span class="line">    swap(lhs.p, rhs.p);</span><br><span class="line">    swap(lhs.deleter, rhs.deleter);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> D&gt;</span><br><span class="line"><span class="keyword">inline</span> Myunique_ptr&lt;T,D&gt;&amp;</span><br><span class="line">Myunique_ptr&lt;T,D&gt;::<span class="keyword">operator</span>=(Myunique_ptr &amp;&amp;mp)<span class="keyword">noexcept</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;p != mp.p)</span><br><span class="line">    &#123;</span><br><span class="line">        deleter(p);</span><br><span class="line">        p = <span class="literal">nullptr</span>;</span><br><span class="line">        ::swap(*<span class="keyword">this</span>, mp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> D&gt;</span><br><span class="line"><span class="keyword">inline</span> Myunique_ptr&lt;T,D&gt;&amp;</span><br><span class="line">Myunique_ptr&lt;T,D&gt;::<span class="keyword">operator</span>=(<span class="built_in">std</span>::<span class="keyword">nullptr_t</span> n)<span class="keyword">noexcept</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(n == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        deleter(p);</span><br><span class="line">        p = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> D&gt;</span><br><span class="line"><span class="keyword">inline</span> T*</span><br><span class="line">Myunique_ptr&lt;T,D&gt;::release()</span><br><span class="line">&#123;</span><br><span class="line">    T* ret = p;</span><br><span class="line">    p = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *i = <span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">20</span>);</span><br><span class="line">    Myunique_ptr&lt;<span class="keyword">int</span>&gt;p(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、模板实参推荐"><a href="#4、模板实参推荐" class="headerlink" title="4、模板实参推荐"></a>4、模板实参推荐</h3><h4 id="4-1、类型转换与模板实参推荐"><a href="#4-1、类型转换与模板实参推荐" class="headerlink" title="4.1、类型转换与模板实参推荐"></a>4.1、类型转换与模板实参推荐</h4><p>函数模板在传递实参时会根据实参生成对应参数的函数，但是我们需要注意一点就是只有有限的几种类型会应用于这些实参。</p>
<p>编译器通常不对实参进行类型转换，而是像上面说的生成新的对应参数的函数。</p>
<p>在类型转换中，能用于函数模板的有以下两种。</p>
<p>1.<code>const </code>转换：也就是非<code>const</code>类型的参数传递给<code>const</code>类型的形参，注意必须是引用或指针，如果不是引用或指针传递的就是拷贝。</p>
<p>2.数组或函数指针转换：如果函数形参不是引用类型，则可以对数组或函数类型的实参应用正常的指针转换。</p>
<p>其他如算术转换，派生类向基类的转换，用户定义的转换都不能用于函数模板。</p>
<p>总结：</p>
<p>将实参传递给代模板类型的参数时，能够自动类型转换的只有<code>const</code>转换及数组或函数到指针的转换。</p>
<p>如果想要传递不同的参数，则我们必须自己定义那种不同的模板类型。</p>
<p>如果函数模板的参数不是模板则可以正常进行转换。</p>
<h4 id="4-2、函数模板显式实参"><a href="#4-2、函数模板显式实参" class="headerlink" title="4.2、函数模板显式实参"></a>4.2、函数模板显式实参</h4><p>有些时候我们必须显示的指定一些模板的参数</p>
<p>比如</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2, <span class="keyword">typename</span> T3&gt;</span><br><span class="line"><span class="function">T1 <span class="title">sum</span><span class="params">(T2, T3)</span></span>;</span><br></pre></td></tr></table></figure>

<p>这个函数中，我们返回是一个模板参数，在函数中，没有任何类型能推断出T1的类型，所以我们要显式指定 </p>
<p>我们提供显式模板实参的方式与定义类模板实例的方式相同，显式模板实参在尖括号中给出，位于函数名之后，实参列表之前。</p>
<p><code>auto val = sum&lt;long long&gt;(t1, t2);</code></p>
<p>显式模板参数按照从左到右的顺序和对应的模板参数匹配，只有尾部最右参数的显示模板实参才可以忽略，前提是他们可以从函数参数推断出来。</p>
<p>如果我们把上面的改为</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2, <span class="keyword">typename</span> T3&gt;</span><br><span class="line"><span class="function">T3 <span class="title">sum</span><span class="params">(T2, T1)</span></span>;</span><br></pre></td></tr></table></figure>

<p>就必须显式的指定三个参数的类型 </p>
<p><code>auto val = sum&lt;long long , long ,int &gt;(t1, t2, t3);</code></p>
<h4 id="4-3、尾置返回类型与类型转换"><a href="#4-3、尾置返回类型与类型转换" class="headerlink" title="4.3、尾置返回类型与类型转换"></a>4.3、尾置返回类型与类型转换</h4><p>一些情况下，要求显式指定模板实参会给用户添加额外负担，且不会带来什么好处。</p>
<p>此时我们可以使用尾置返回类型。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">auto func(T Beg, T End)-&gt;decltype(*Beg)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> *(Beg+(End-Beg)/<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;svec = &#123;<span class="string">&quot;111&quot;</span>,<span class="string">&quot;222&quot;</span>,<span class="string">&quot;333&quot;</span>&#125;;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; func(svec.begin(), svec.end()) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是上述代码有一个限制，传参是迭代器，则我们返回的只能是元素的引用而不是元素。 </p>
<p>为了获取元素类型，可以使用标准库的类型转换</p>
<p>头文件<code>#include &lt;type_traits&gt;</code>  这个头文件常用于模板元程序设计。</p>
<p>但是类型转换模板在普通编程中也很有用</p>
<p>上面问题可以用<code>remove_reference</code>来解决</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto func(T Beg, T End)-&gt;</span><br><span class="line">      <span class="keyword">typename</span> <span class="built_in">std</span>::remove_reference&lt;<span class="keyword">decltype</span>(*Beg)&gt;::type;          <span class="comment">//因为是类型所以要加typename,前面说过,否则不能区分是类型还是变量</span></span><br></pre></td></tr></table></figure>

<p>模板类型<code>remove_reference</code>的<code>type</code>成员表示被引用的类型。 </p>
<p>还有其他的类型转换模板</p>
<p>标准类型转换模板</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="number">1.</span>remove_reference</span><br><span class="line">&lt;<span class="number">2.</span>add_const</span><br><span class="line">&lt;<span class="number">3.</span>add_lvalue_reference</span><br><span class="line">&lt;<span class="number">4.</span>add_rvalue_reference</span><br><span class="line">&lt;<span class="number">5.</span>remove_pointer</span><br><span class="line">&lt;<span class="number">6.</span>add_pointer</span><br><span class="line">&lt;<span class="number">7.</span>make_signed</span><br><span class="line">&lt;<span class="number">8.</span>make_unsigned</span><br><span class="line">&lt;<span class="number">9.</span>remove_extent</span><br><span class="line">&lt;<span class="number">10.</span>remove_all_extents</span><br></pre></td></tr></table></figure>

<p>其他的使用都和remove_reference类似。每个模板都有一个<code>type</code>的<code>public</code>成员表示类型。</p>
<p>注意有时<code>type</code>不是元素的类型，比如指针，type就不是指针类型而是指针指向的元素类型。</p>
<h4 id="4-4、函数指针和实参推荐"><a href="#4-4、函数指针和实参推荐" class="headerlink" title="4.4、函数指针和实参推荐"></a>4.4、函数指针和实参推荐</h4><p>我们用一个函数模板初始化一个函数指针或为一个函数指针赋值时。编译器会用指针的类型来推断模板</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T <span class="title">fun</span><span class="params">(T,T)</span></span>;</span><br><span class="line"><span class="keyword">int</span> (*p)(<span class="keyword">int</span>,<span class="keyword">int</span>) = fun;</span><br></pre></td></tr></table></figure>

<p>那么p就指向了fun的int实例化版本。</p>
<p>当然也可以显式指定</p>
<p><code>fun&lt;int&gt;</code></p>
<p>注意：当参数是一个函数模板实例的地址时，程序上下文必须满则：对每个模板参数能唯一确定其类型或值。</p>
<h4 id="4-5、模板实参推断和引用"><a href="#4-5、模板实参推断和引用" class="headerlink" title="4.5、模板实参推断和引用"></a>4.5、模板实参推断和引用</h4><h5 id="4-5-1、从左值引用函数参数推断类型"><a href="#4-5-1、从左值引用函数参数推断类型" class="headerlink" title="4.5.1、从左值引用函数参数推断类型"></a>4.5.1、从左值引用函数参数推断类型</h5><p>当一个函数类型参数是普通的左值引用时，规定只能传递给它一个左值（一个变量或一个引用的表达式），实参可以是<code>const</code>类型也可以不是。</p>
<p>如果实参是<code>const</code>类型，T将会被推断是<code>const</code>类型</p>
<p>如果函数类型参数是<code>const&amp;T</code>时，我们可以传递任何类型的实参，一个对象，一个临时对象或者字面值常量。</p>
<h5 id="4-5-2、从右值引用函数参数推断类型"><a href="#4-5-2、从右值引用函数参数推断类型" class="headerlink" title="4.5.2、从右值引用函数参数推断类型"></a>4.5.2、从右值引用函数参数推断类型</h5><p>我们可以传递一个右值，推断规则类似左值引用。</p>
<p>左值不能绑定在右值引用上，但是有两个例外规则。</p>
<p>第一个：当我们将一个左值传递给函数的右值引用参数时，编译器推断模板类型参数为实参的左值引用类型。注意是引用。</p>
<p>比如传递给模板函数参数T &amp;&amp;一个int i,推断出来的类型就是int &amp;.</p>
<p>第二个：如果我们间接创建一个引用的引用就会形成引用折叠，引用折叠在大部分情况下会形成一个普通的左值引用，但是在右值引用的引用情况下</p>
<p>会生成右值引用。</p>
<p><code>X&amp; &amp;, X&amp; &amp;&amp;和X&amp;&amp; &amp;都折叠成X&amp;</code></p>
<p><code>X&amp;&amp; &amp;&amp;折叠成X&amp;&amp;</code></p>
<p>注意：引用折叠只能应用于间接创建的引用的引用，如类型别名或模板参数。</p>
<p>这两个规则导致了两个重要的结果：</p>
<p>1.如果一个函数参数是一个指向模板类型蚕食的右值引用，则它可以被绑定到一个左值上。</p>
<p>2.如果实参是一个左值，则推断出的模板实参类型是一个左值引用，且函数参数将被实例化一个左值引用参数。</p>
<p>注意：如果一个函数参数是指向模板参数类型的右值引用，则可以传递给它任何类型的实参，如果将一个左值传递给这样的参数，则函数参数被实例化为一个普通</p>
<p>左值引用。</p>
<h5 id="4-5-3、编写接受右值引用参数的模板函数"><a href="#4-5-3、编写接受右值引用参数的模板函数" class="headerlink" title="4.5.3、编写接受右值引用参数的模板函数"></a>4.5.3、编写接受右值引用参数的模板函数</h5><p>使用右值引用的函数模板应该向我们之前所写的一样</p>
<p>定义两种。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(T&amp;&amp;)</span></span>;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> T&amp;)</span></span>;</span><br></pre></td></tr></table></figure>

<p>可避免一些错误。 </p>
<p>总之：泛型模板编程要细心，时刻注意参数问题。</p>
<p>模板参数是右值引用，传递右值引用，推断出是T</p>
<p>模板参数是右值引用，传递左值，推断出是左值引用。</p>
<h4 id="4-6、理解std-move"><a href="#4-6、理解std-move" class="headerlink" title="4.6、理解std::move"></a>4.6、理解std::move</h4><p>标准库定义<code>std::move</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> remove_reference&lt;T&gt;::<span class="function">type&amp;&amp; <span class="title">move</span><span class="params">(T &amp;&amp; t)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="keyword">typename</span> remove_reference&lt;T&gt;::type&amp;&amp;&gt;(t);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><code>std::move</code>的参数是<code>T &amp;&amp;t</code>,是一个指向模板类型的右值引用，通过引用折叠可以和任何类型的参数匹配。 </p>
<p>从一个左值<code>static_cast</code>到一个右值引用是允许的。</p>
<h4 id="4-7、转发"><a href="#4-7、转发" class="headerlink" title="4.7、转发"></a>4.7、转发</h4><p>某些函数需要将一个或多个实参连同类型传递给其他的函数，这种情况下我们需要保证实参的类型。</p>
<p>举个例子来说明</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unility&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(F f, T1 t1, T2 t2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    f(t1, t2);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> &amp;v2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(<span class="keyword">int</span> &amp;&amp;v1, <span class="keyword">int</span> &amp;v2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span>, j = <span class="number">20</span>;</span><br><span class="line">    fun(f, i, j);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//改进后</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(F f, T1 &amp;&amp;t1, T2 &amp;&amp;t2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    f(<span class="built_in">std</span>::forward&lt;T1&gt;(t1), <span class="built_in">std</span>::forward&lt;T2&gt;(t2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第一个函数，在<code>fun</code>里面调用<code>f</code>，<code>f</code>第二个参数是一个引用，说明我们希望在<code>f</code> 函数中改变<code>j</code>的值，但是在<code>fun</code>传递参数的时候就发生了拷贝， </p>
<p>所以我们传递给<code>f </code>的参数也是一份拷贝，修改了拷贝实际上没有修改到j 的值。</p>
<p>改进有两个方面：</p>
<ol>
<li>参数变成右值引用</li>
</ol>
<p>通过将一个函数参数定义为一个指向模板类型参数的右值引用，我们可以保持其对应实参的所有类型信息。</p>
<p>引用类型中<code>const</code>是底层的，我们可以保证<code>const</code>属性，通过引用折叠我们可以保持翻转实参的左值/右值属性。</p>
<p>结论：如果一个函数参数是指向模板类型参数的右值引用， 它对应的实参的<code>const </code>属性和左值/右值属性得到保持。</p>
<ol start="2">
<li>使用<code>std::forward</code>：如果参数不是一个左值引用，返回右值，如果参数是一个左值引用，返回该返回的类型。</li>
</ol>
<p>头文件<code>#include &lt;utility&gt;</code></p>
<p>当传递一个右值引用时，我们知道右值引用也是一个左值表达式。在调用<code>g</code>时就会出错，不能将左值绑定到右值上。</p>
<p>我们可以使用一个<code>forward</code>的新标准库来传递参数，它能保持原始实参的类型。</p>
<p><code>forward</code>必须通过显式模板参数来调用。<code>forward</code>返回该显式实参类型的右值引用</p>
<p>通常情况下我们使用<code>forward</code>传递那些定义为模板类型参数的右值引用的函数参数，通过其返回类型上的引用折叠，<code>forward</code>可以保持给定实参的左值/右值属性</p>
<p>上面的改进后函数，如果实参是<code>T1</code>一个右值<code>int </code>传递<code>func</code>，那么T1推断出是int 类型，<code>std::forward&lt;T1&gt;</code>将<code>int </code>变为<code>int&amp;&amp;.</code></p>
<p>如果实参是一个左值， 通过引用折叠，T本身就是一个左值<code>int&amp;。</code></p>
<p><img src="https://zhuom-go.github.io/img/Template/3.png" alt="img"> </p>
<p>顺便贴一下cppman手册里的例子，方便理解</p>
<p><img src="https://zhuom-go.github.io/img/Template/4.png" alt="img"></p>
<p>第一个给<code>fn</code>传递<code>a</code>，<code>a</code>是一个左值，<code>fn</code>的形参是右值引用，前面说过给右值引用传递左值，会变成左值引用，<code>overloaded(x)</code>调用的是左值版本。</p>
<p><code>overloaded(std::forward&lt;T&gt;(x))``x</code>是一个左值引用时，返回一个左值引用，也掉用的是左值的<code>overloaded</code>。</p>
<p>第二个给<code>fn</code>传递0，0是一个右值，fn的形参是右值引用，T推断出是<code>int</code>类型，右值引用也是一个左值，所以调用左值版本，但是使用<code>std::forward</code>时，</p>
<p>上面说了<code>rvalue if argument is rvalue</code>，所以调用右值版本。<code>std::forward&lt;T&gt;(x)</code>返回一个右值。</p>
<h3 id="5、重载和函数模板"><a href="#5、重载和函数模板" class="headerlink" title="5、重载和函数模板"></a>5、重载和函数模板</h3><p>函数模板可以被另一个模板或一个普通非模板函数重载。与往常一样，名字相同的函数必须具有不同数量或类型的参数。</p>
<p>与往常一样，如果恰有一个函数提供比任何其他函数都更好的匹配，则选择此函数。</p>
<p>当有多个重载模板对一个调用提供同样好的匹配时，应选择最特例化的版本。我理解特例话指的是小众，比如两个模板都实例化出了适配的实例，第一个模板作用范围大（比如有<code>const</code>修饰，就可以作用<code>const</code>和<code>non-const</code>），第二个模板作用范围小，那么第二个模板产生的实例就是最特例化的版本。</p>
<p>对于一个调用，如果一个非函数模板与一个函数模板提供同样好的匹配，则选择非模板版本。</p>
<p>在定义任何函数之前，记得声明所有重载的函数版本。这样就不必担心编译器由于未遇到你希望调用的函数而实例化一个并非你所需的版本。</p>
<h3 id="6、可变参数模板（c-11）"><a href="#6、可变参数模板（c-11）" class="headerlink" title="6、可变参数模板（c++11）"></a>6、可变参数模板（c++11）</h3><p>一个可变参数就是一个接受可变数目参数的模板函数或模板类。可变数目的参数被称为参数包。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">const</span> T &amp;t, <span class="keyword">const</span> Args&amp; ... rest)</span></span>;</span><br></pre></td></tr></table></figure>

<p>与往常一样，编译器从函数的实参推断模板参数类型。对于一个可变参数模板，编译器还会推断包中参数的数目。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> ... Args&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">const</span> T &amp;t, <span class="keyword">const</span> Args&amp; ... rest)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="keyword">sizeof</span>...(Args) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;   </span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="keyword">sizeof</span>...(rest) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">double</span> d = <span class="number">1.1</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> s = <span class="string">&quot;ss&quot;</span>;</span><br><span class="line">    foo(i, d, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>result: 2 </code></p>
<p>定义就如同例子里面定义一样，sizeof…当我们需要知道包中有多少个元素的时候就可以使用sizeof…</p>
<h5 id="6-1、编写可变参数函数模板"><a href="#6-1、编写可变参数函数模板" class="headerlink" title="6.1、编写可变参数函数模板"></a>6.1、编写可变参数函数模板</h5><p>以前说过initializer_list定义一个可变数目参数的函数，但是类型是指定的。</p>
<p>当我们既不知道参数的数目和参数的类型时，可变参数函数是很有用的。</p>
<p>可变参数函数通常是递归的，第一步调用处理包中的第一个实参，然后用剩余实参调用自身。</p>
<p>通过例子来理解：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="function"><span class="built_in">std</span>::ostream&amp; <span class="title">print</span><span class="params">(<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> T&amp;t, <span class="keyword">const</span> Args&amp;... rest)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="built_in">std</span>::ostream&amp; <span class="title">print</span><span class="params">(<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> T&amp;t)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="function"><span class="built_in">std</span>::ostream&amp; <span class="title">print</span><span class="params">(<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> T&amp;t, <span class="keyword">const</span> Args&amp;... rest)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    os &lt;&lt; t &lt;&lt; <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> print(os, rest...);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="built_in">std</span>::ostream&amp; <span class="title">print</span><span class="params">(<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> T&amp;t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    os &lt;&lt; t;</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">    <span class="keyword">double</span> d = <span class="number">1.1</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> s = <span class="string">&quot;ss&quot;</span>;</span><br><span class="line">    print(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="number">1</span>) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    print(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="number">1</span>,<span class="number">2</span>) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    print(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    print(<span class="built_in">std</span>::<span class="built_in">cout</span>, i, c, d, s) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://zhuom-go.github.io/img/Template/5.png" alt="img"></p>
<p><strong>从打印逗号的情况我们可以看出最后一个调用的是两参版本。其他几次都调用的是三参版本</strong></p>
<p>是一个递归的执行过程，每次打印一个参数，包中就少一个参数，直到打印最后一个参数时，我们必须定义两参版本。</p>
<p>两参版本负责终止递归并打印初始调用中的最后一个实参。</p>
<p>注意：当定义可变参数版本的<code>print</code>时，非可变参数版本的声明必须在作用域中，否则，可变参数版本会无限递归。</p>
<p>​      好的做法是都在最开始声明。</p>
<h5 id="6-2、模板特例化（特化）"><a href="#6-2、模板特例化（特化）" class="headerlink" title="6.2、模板特例化（特化）"></a>6.2、模板特例化（特化）</h5><p>所谓模板特化就是针对模板特殊情况特殊处理。</p>
<p>模板实例化是在第一次使用时，编译器会按确定的类型生成对应的实例模板。</p>
<p>我们可以定义函数模板和类模板的特例化</p>
<p>特例化本质是一个模板，而非重载，所以特例化本质不影响函数匹配。</p>
<p>模板及其特例化应该声明到同一个头文件中，所有同名模板的声明应该放在前面，然后是这些模板的特例化版本。</p>
<p>类模板部分特例化</p>
<p>注意：我们只能部分特例化类模板，而不能部分特例化函数模板。</p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/STL/" rel="tag"><i class="fa fa-tag"></i> STL</a>
              <a href="/tags/Template/" rel="tag"><i class="fa fa-tag"></i> Template</a>
          </div>
		  <script type="text/javascript">
          var tagsall=document.getElementsByClassName("post-tags")
          for (var i = tagsall.length - 1; i >= 0; i--){
              var tags=tagsall[i].getElementsByTagName("a");
              for (var j = tags.length - 1; j >= 0; j--) {
                  var r=Math.floor(Math.random()*75+150);
                  var g=Math.floor(Math.random()*75+180);
                  var b=Math.floor(Math.random()*75+100);
                  tags[j].style.background = "rgb("+r+","+g+","+b+")";
              }
          }                        
          </script>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/18/C++%E4%B8%ADStatic%E4%BD%9C%E7%94%A8%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" rel="prev" title="C++中Static作用和使用方法">
      <i class="fa fa-chevron-left"></i> C++中Static作用和使用方法
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/11/20/Qt%E6%A7%BD%E5%87%BD%E6%95%B0%E7%BB%91%E5%AE%9A/" rel="next" title="Qt槽函数使用Lambda绑定">
      Qt槽函数使用Lambda绑定 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF"><span class="nav-text">1、函数模板</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1%E3%80%81%E5%AE%9A%E4%B9%89%E6%A8%A1%E6%9D%BF"><span class="nav-text">1.1、定义模板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2%E3%80%81%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0"><span class="nav-text">1.2、类型参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3%E3%80%81%E9%9D%9E%E7%B1%BB%E5%9E%8B%E6%A8%A1%E6%9D%BF%E5%8F%82%E6%95%B0"><span class="nav-text">1.3、非类型模板参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4%E3%80%81%E7%BC%96%E5%86%99%E7%B1%BB%E5%9E%8B%E6%97%A0%E5%85%B3%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="nav-text">1.4、编写类型无关的代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5%E3%80%81%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91"><span class="nav-text">1.5、模板编译</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6%E3%80%81%E5%A4%A7%E5%A4%9A%E6%95%B0%E7%BC%96%E8%AF%91%E9%94%99%E8%AF%AF%E5%9C%A8%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%9C%9F%E9%97%B4%E6%8A%A5%E5%91%8A"><span class="nav-text">1.6、大多数编译错误在实例化期间报告</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E7%B1%BB%E6%A8%A1%E6%9D%BF"><span class="nav-text">2、类模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%A8%A1%E6%9D%BF%E5%8F%82%E6%95%B0"><span class="nav-text">3、模板参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1%E3%80%81%E6%A8%A1%E6%9D%BF%E5%8F%82%E6%95%B0%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-text">3.1、模板参数和作用域</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2%E3%80%81%E4%BD%BF%E7%94%A8%E7%B1%BB%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%88%90%E5%91%98"><span class="nav-text">3.2、使用类的类型成员</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3%E3%80%81%E9%BB%98%E8%AE%A4%E6%A8%A1%E6%9D%BF%E5%AE%9E%E5%8F%82"><span class="nav-text">3.3、默认模板实参</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4%E3%80%81%E6%88%90%E5%91%98%E6%A8%A1%E6%9D%BF"><span class="nav-text">3.4、成员模板</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-1%E3%80%81%E6%99%AE%E9%80%9A%EF%BC%88%E9%9D%9E%E6%A8%A1%E6%9D%BF%EF%BC%89%E7%B1%BB%E7%9A%84%E6%88%90%E5%91%98%E6%A8%A1%E6%9D%BF"><span class="nav-text">3.4.1、普通（非模板）类的成员模板</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-2%E3%80%81%E7%B1%BB%E6%A8%A1%E6%9D%BF%E7%9A%84%E6%88%90%E5%91%98%E6%A8%A1%E6%9D%BF"><span class="nav-text">3.4.2、类模板的成员模板</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-3%E3%80%81%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%B8%8E%E6%88%90%E5%91%98%E6%A8%A1%E6%9D%BF"><span class="nav-text">3.4.3、实例化与成员模板</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5%E3%80%81%E6%8E%A7%E5%88%B6%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="nav-text">3.5、控制实例化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6%E3%80%81%E6%95%88%E7%8E%87%E4%B8%8E%E7%81%B5%E6%B4%BB%E6%80%A7"><span class="nav-text">3.6、效率与灵活性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E6%A8%A1%E6%9D%BF%E5%AE%9E%E5%8F%82%E6%8E%A8%E8%8D%90"><span class="nav-text">4、模板实参推荐</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1%E3%80%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E4%B8%8E%E6%A8%A1%E6%9D%BF%E5%AE%9E%E5%8F%82%E6%8E%A8%E8%8D%90"><span class="nav-text">4.1、类型转换与模板实参推荐</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2%E3%80%81%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF%E6%98%BE%E5%BC%8F%E5%AE%9E%E5%8F%82"><span class="nav-text">4.2、函数模板显式实参</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3%E3%80%81%E5%B0%BE%E7%BD%AE%E8%BF%94%E5%9B%9E%E7%B1%BB%E5%9E%8B%E4%B8%8E%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-text">4.3、尾置返回类型与类型转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4%E3%80%81%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E5%92%8C%E5%AE%9E%E5%8F%82%E6%8E%A8%E8%8D%90"><span class="nav-text">4.4、函数指针和实参推荐</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5%E3%80%81%E6%A8%A1%E6%9D%BF%E5%AE%9E%E5%8F%82%E6%8E%A8%E6%96%AD%E5%92%8C%E5%BC%95%E7%94%A8"><span class="nav-text">4.5、模板实参推断和引用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-5-1%E3%80%81%E4%BB%8E%E5%B7%A6%E5%80%BC%E5%BC%95%E7%94%A8%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E6%8E%A8%E6%96%AD%E7%B1%BB%E5%9E%8B"><span class="nav-text">4.5.1、从左值引用函数参数推断类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-5-2%E3%80%81%E4%BB%8E%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E6%8E%A8%E6%96%AD%E7%B1%BB%E5%9E%8B"><span class="nav-text">4.5.2、从右值引用函数参数推断类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-5-3%E3%80%81%E7%BC%96%E5%86%99%E6%8E%A5%E5%8F%97%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8%E5%8F%82%E6%95%B0%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%87%BD%E6%95%B0"><span class="nav-text">4.5.3、编写接受右值引用参数的模板函数</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-6%E3%80%81%E7%90%86%E8%A7%A3std-move"><span class="nav-text">4.6、理解std::move</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-7%E3%80%81%E8%BD%AC%E5%8F%91"><span class="nav-text">4.7、转发</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E9%87%8D%E8%BD%BD%E5%92%8C%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF"><span class="nav-text">5、重载和函数模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E6%A8%A1%E6%9D%BF%EF%BC%88c-11%EF%BC%89"><span class="nav-text">6、可变参数模板（c++11）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1%E3%80%81%E7%BC%96%E5%86%99%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF"><span class="nav-text">6.1、编写可变参数函数模板</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-2%E3%80%81%E6%A8%A1%E6%9D%BF%E7%89%B9%E4%BE%8B%E5%8C%96%EF%BC%88%E7%89%B9%E5%8C%96%EF%BC%89"><span class="nav-text">6.2、模板特例化（特化）</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhuoM"
      src="/img/Logo.png">
  <p class="site-author-name" itemprop="name">zhuoM</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
	<h3></h3>
	<h3></h3>
    <div style="">
  <canvas id="canvas" style="width:60%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>

	
    <script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
    <script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
    <div class="widget-wrap">
        <h3 class="widget-title"></h3>
        <div id="myCanvasContainer" class="widget tagcloud">
            <canvas width="250" height="250" id="resCanvas" style="width=100%">
                <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Effective-Modern-C/" rel="tag">Effective Modern C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lambda/" rel="tag">Lambda</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PLC/" rel="tag">PLC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QString/" rel="tag">QString</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt/" rel="tag">Qt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STL/" rel="tag">STL</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Static/" rel="tag">Static</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Template/" rel="tag">Template</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/assign/" rel="tag">assign</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bind/" rel="tag">bind</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/connect/" rel="tag">connect</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/const/" rel="tag">const</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/constexpr/" rel="tag">constexpr</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/explicit/" rel="tag">explicit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/extern/" rel="tag">extern</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/function/" rel="tag">function</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/initializer-list/" rel="tag">initializer_list</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/move/" rel="tag">move</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/push-bak/" rel="tag">push_bak</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/static-cast/" rel="tag">static_cast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/string/" rel="tag">string</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tuple/" rel="tag">tuple</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typedef/" rel="tag">typedef</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typeid/" rel="tag">typeid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/using/" rel="tag">using</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vector/" rel="tag">vector</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/" rel="tag">内存分配</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88/" rel="tag">函数指针</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8B%E5%85%83%E5%87%BD%E6%95%B0/" rel="tag">友元函数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%B3%E5%80%BC/" rel="tag">右值</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%B9%E5%99%A8%E7%AE%97%E6%B3%95/" rel="tag">容器算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" rel="tag">数据结构与算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%8B%E8%BD%AC%E5%8F%98%E5%8C%96/" rel="tag">旋转变化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/" rel="tag">智能指针</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E6%8D%A2/" rel="tag">转换</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8/" rel="tag">迭代器</a><span class="tag-list-count">1</span></li></ul>
            </canvas>
         </div>
    </div>

	
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhuoM</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">158k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">2:24</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

  

  <script async src="/js/cursor/fireworks.js"></script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'qd4EK8z8jRMopJAh5Qy45UMq-gzGzoHsz',
      appKey     : 'VVPNVnpHyBVnYXp0DTST8vtc',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>
<div class="moon-menu">
  <div class="moon-menu-items">
    
    <div class="moon-menu-item" onclick="back2bottom()">
      <i class='fa fa-chevron-down'></i>    </div>
    
    <div class="moon-menu-item" onclick="back2top()">
      <i class='fa fa-chevron-up'></i>    </div>
    
  </div>
  <div class="moon-menu-button">
    <svg class="moon-menu-bg">
      <circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle>
      <circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle>
    </svg>
    <div class="moon-menu-content">
      <div class="moon-menu-icon"><i class='fas fa-ellipsis-v'></i></div>
      <div class="moon-menu-text"></div>
    </div>
  </div>
</div><script src="/js/injector.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300,"vOffset":130},"mobile":{"show":true},"log":false,"tagMode":false});</script></body>
</html>
